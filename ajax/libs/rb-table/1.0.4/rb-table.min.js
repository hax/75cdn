!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):e.RBTable=t(e.React)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;10>n;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}();var o="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function i(){}var l,s,a,c,d,u,f,h,p,m,y,w,v,b,_,g,E=(function(e){e.exports=function(){function e(e,t,n,r,i,l){if(l!==o){var s=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=i,n.PropTypes=n,n}()}(l={exports:{}},l.exports),l.exports),M=!1;function x(){if(!M){M=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),n=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(v=/\b(iPhone|iP[ao]d)/.exec(e),b=/\b(iP[ao]d)/.exec(e),y=/Android/i.exec(e),_=/FBAN\/\w+;/i.exec(e),g=/Mobile/i.exec(e),w=!!/Win64/.exec(e),t){(s=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(s=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(e);f=r?parseFloat(r[1])+4:s,a=t[2]?parseFloat(t[2]):NaN,c=t[3]?parseFloat(t[3]):NaN,(d=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),u=t&&t[1]?parseFloat(t[1]):NaN):u=NaN}else s=a=c=u=d=NaN;if(n){if(n[1]){var o=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);h=!o||parseFloat(o[1].replace("_","."))}else h=!1;p=!!n[2],m=!!n[3]}else h=p=m=!1}}var S,O={ie:function(){return x()||s},ieCompatibilityMode:function(){return x()||f>s},ie64:function(){return O.ie()&&w},firefox:function(){return x()||a},opera:function(){return x()||c},webkit:function(){return x()||d},safari:function(){return O.webkit()},chrome:function(){return x()||u},windows:function(){return x()||p},osx:function(){return x()||h},linux:function(){return x()||m},iphone:function(){return x()||v},mobile:function(){return x()||v||b||y||g},nativeApp:function(){return x()||_},android:function(){return x()||y},ipad:function(){return x()||b}},R=O,N=!("undefined"==typeof window||!window.document||!window.document.createElement),C={canUseDOM:N,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:N&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:N&&!!window.screen,isInWorker:!N};C.canUseDOM&&(S=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""));var D=function(e,t){if(!C.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var o=document.createElement("div");o.setAttribute(n,"return;"),r="function"==typeof o[n]}return!r&&S&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r},T=10,W=40,L=800;function k(e){var t=0,n=0,r=0,o=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=t*T,o=n*T,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||o)&&e.deltaMode&&(1==e.deltaMode?(r*=W,o*=W):(r*=L,o*=L)),r&&!t&&(t=1>r?-1:1),o&&!n&&(n=1>o?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:o}}k.getEventType=function(){return R.firefox()?"DOMMouseScroll":D("wheel")?"wheel":"mousewheel"};var B,P,z=k,F=navigator.userAgent.match(/Trident/),q=(B=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},function(e){return B(e)}),A=(P=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout,function(e){return P(e)});function H(e){var t=e.target||e.srcElement;t.__resizeRAF__&&A(t.__resizeRAF__),t.__resizeRAF__=q(function(){var n=t.__resizeTrigger__;n.__resizeListeners__.forEach(function(t){t.call(n,e)})})}function j(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",H)}function I(e,t){if(!e.__resizeListeners__){e.__resizeListeners__=[];var n=e.__resizeTrigger__=document.createElement("object");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),n.__resizeElement__=e,n.onload=j,n.type="text/html",F&&e.appendChild(n),n.data="about:blank",F||e.appendChild(n)}e.__resizeListeners__.push(t)}function X(e,t){var n={};for(var r in e)0>t.indexOf(r)&&Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function U(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];if(t)return"string"==typeof t||"number"==typeof t?t:"function"==typeof t?t.apply(void 0,r):e.isValidElement(t)?e.cloneElement(t,{tableContext:r}):void 0}function Y(e){return e.width?{width:e.width}:null}function V(e){return e?e+"px":e}function G(e,t){e.style.height=t}function K(e,t,n){return e.width&&e[t]?Error(n+".column."+t+" will not take effect when column.width is set."):"maxWidth"===t&&e.minWidth>e.maxWidth?Error(n+".column.maxWidth is smaller then column.minWidth"):void 0}var Z=function(t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,t.call(this,e));return r.setTableRef=r.setTableRef.bind(r),r.handleResize=r.handleResize.bind(r),r.handleScroll=r.handleScroll.bind(r),r.handleClickRow=r.handleClickRow.bind(r),r.handleWindowMouseUp=r.handleWindowMouseUp.bind(r),r.handleWindowMouseMove=r.handleWindowMouseMove.bind(r),r.hScrollPanelMouseDown=r.hScrollPanelMouseDown.bind(r),r.vScrollPanelMouseDown=r.vScrollPanelMouseDown.bind(r),r.hScrollBarMouseDown=r.hScrollBarMouseDown.bind(r),r.vScrollBarMouseDown=r.vScrollBarMouseDown.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),n.prototype.componentWillUnmount=function(){I(this.table,this.handleResize),window.removeEventListener("mouseup",this.handleWindowMouseUp),window.removeEventListener("mousemove",this.handleWindowMouseMove)},n.prototype.componentDidMount=function(){var e=this;window.addEventListener("mouseup",this.handleWindowMouseUp),window.addEventListener("mousemove",this.handleWindowMouseMove),setTimeout(function(){e.reflow()})},n.prototype.setTableRef=function(e){var t,n;e&&(this.table&&(n=this.handleResize,(t=this.table).__resizeListeners__&&(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(n),1),t.__resizeListeners__.length||(t.__resizeTrigger__.contentDocument.defaultView.removeEventListener("resize",H),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)))),this.table=e,I(e,this.handleResize))},n.prototype.componentDidUpdate=function(){this.reflow()},n.prototype.handleResize=function(){this.reflow()},n.prototype.reflow=function(){this.alignTable(),this.scrollByOffset(0,0)},n.prototype.handleScroll=function(e){var t=z(e),n=t.pixelY,r=t.pixelX;n=Math.round(.5*n);var o=this.scrollByOffset(r=Math.round(.5*r),n).hasOffset;e.preventDefault(),o&&e.stopPropagation()},n.prototype.handleClickRow=function(e,t){this.props.onRowClick&&this.props.onRowClick(e,t)},n.prototype.setLocation=function(e,t){this.x=e,this.y=t},n.prototype.handleWindowMouseUp=function(){this.mouseIsDownRight=!1,this.mouseIsDownBottom=!1},n.prototype.handleWindowMouseMove=function(e){var t=e.clientY;this.mouseIsDownBottom?this.handleMouseMove(e.clientX,0):this.mouseIsDownRight&&this.handleMouseMove(0,t)},n.prototype.hScrollPanelMouseDown=function(e){e.preventDefault();var t=e.clientX-this.refs.hScrollBar.getBoundingClientRect().left;this.scrollByOffset(t,0)},n.prototype.vScrollPanelMouseDown=function(e){e.preventDefault();var t=e.clientY-this.refs.vScrollBar.getBoundingClientRect().top;this.scrollByOffset(0,t)},n.prototype.hScrollBarMouseDown=function(e){e.preventDefault(),e.stopPropagation(),this.mouseIsDownBottom=!0,this.setLocation(e)},n.prototype.vScrollBarMouseDown=function(e){e.preventDefault(),e.stopPropagation(),this.mouseIsDownRight=!0,this.setLocation(e)},n.prototype.handleMouseMove=function(e,t){var n=e-this.x,r=t-this.y;this.setLocation(e,t),this.scrollByOffset(n,r)},n.prototype.getHoverClass=function(){var e=this.props.prefixCls,t=" "+e+"-row--hover";return this.props.onRowClick&&(t+=e+"-row--clickable"),t},n.prototype.bodies=function(){var e=this.refs;return[e.bodyMiddleContent,e.bodyLeftContent,e.bodyRightContent].filter(function(e){return!!e})},n.prototype.handleRowEnter=function(e){var t=this;this.bodies().forEach(function(n){return n.children[e].className+=t.getHoverClass()})},n.prototype.handleRowLeave=function(e){var t=this;this.bodies().forEach(function(n){return n.children[e].className=n.children[e].className.replace(t.getHoverClass(),"")})},n.prototype.getTableWidthHeight=function(){var e=this.refs.virtualTable,t=[],n=[],r=e.querySelector("thead > tr"),o=e.querySelector("colgroup");function i(){for(var e=0;r.children.length>e;e++)t[e]=r.children[e].offsetWidth+1}return this.props.columns.forEach(function(e,t){o.children[t].style.width=V(e.width||"")}),i(),this.props.columns.forEach(function(e,n){var r=e.width,i=e.minWidth,l=e.maxWidth;(l||i)&&(r=t[n],r=Math.min(l||r,r),o.children[n].style.width=V(r=Math.max(i||r,r)))}),i(),e.querySelectorAll("tbody > tr").forEach(function(e,t){n[t]=e.offsetHeight}),{columnWs:t,rowHs:n}},n.prototype.alignTable=function(){var e=this,t=this.refs,n=t.headerLeft,r=t.headerRight,o=t.body,i=this.props.columns,l=[n,r].filter(function(e){return!!e});l.forEach(function(e){G(e.querySelector("tr"),"")});var s,a,c=this.getTableWidthHeight(),d=c.columnWs,u=c.rowHs,f=this.refs.virtualTable.querySelector("thead > tr").clientHeight,h=this.table.clientHeight,p=this.refs.hScrollPanel.offsetHeight,m=this.refs.bodyMiddle.querySelector("colgroup"),y=this.refs.headerMiddle.querySelector("colgroup"),w=0,v=0;d.forEach(function(t,o){var l=V(t);w+=t,m.children[o].style.width=l,y.children[o].style.width=l,i[o].width||("left"===i[o].fixed?(n.querySelector("colgroup").children[o].style.width=l,e.refs.bodyLeft.querySelector("colgroup").children[o].style.width=l):"right"===i[o].fixed&&(r.querySelector("colgroup").children[v].style.width=l,e.refs.bodyRight.querySelector("colgroup").children[v].style.width=l,v++))}),s=this.refs.header,a=V(w=Math.max(w,this.refs.scrollX.clientWidth)),s.style.width=a,o.style.width=V(this.refs.header.clientWidth+300+o.offsetWidth-o.clientWidth);var b=this.refs.header.offsetHeight;l.forEach(function(e){G(e.querySelector("tr"),V(f)),G(e.parentElement,V(b))}),this.bodies().forEach(function(e){!function(e,t){for(var n=0;e.children.length>n;n++)t(e.children[n],n)}(e,function(e,t){return G(e,V(u[t]))})}),this.refs.body.style.height=V(h-b-p)},n.prototype.scrollByOffset=function(e,t){if(this.table){var n=this.refs,r=n.bodyMiddle,o=n.hScrollBar,i=n.hScrollPanel,l=n.vScrollBar,s=n.vScrollPanel;if(r){var a=this.refs.scrollX.offsetWidth,c=this.refs.body.clientHeight,d=r.offsetWidth,u=r.offsetHeight,f=1,h=1;if(u>c||(s.style.visibility="hidden",l=null,s=null),d>a||(i.style.visibility="hidden",o=null,i=null),o){var p=i.offsetWidth,m=p*a/d;f=(d-a)/(p-m)}if(l){var y=s.offsetHeight,w=y*c/u;h=(u-c)/(y-w)}t*=h;var v=Math.round(this.refs.scrollX.scrollLeft+(e*=f)),b=Math.round(this.refs.body.scrollTop+t),_=!0;if(v>d-a&&(v=d-a,_=!1),0>v&&(v=0,_=!1),b>u-c&&(b=u-c,_=!1),0>b&&(b=0,_=!1),this.refs.body.scrollTop=b,this.refs.scrollX.scrollLeft=v,o)i.style.visibility="visible",o.style.width=Math.round(m)+"px",o.style.transform="translateX("+Math.round(v/f)+"px)";if(E(this.refs.bodyLeft,v),E(this.refs.bodyRight,v-d+a),l){var g=Math.round(b/h);s.style.visibility="visible",l.style.height=Math.round(w)+"px",l.style.transform="translateY("+g+"px)"}return{hasOffset:_}}}function E(e,t){e&&(0===t&&e?e.parentElement.parentElement.style.display="none":(e.parentElement.parentElement.style.display="block",e.style.transform="translateY("+-b+"px)"))}},n.prototype.renderHeaderSideOf=function(t){var n=t.side,r=X(t,["side"]),o=n.toLowerCase(),i=r[o+"Columns"];if(0===i.length)return null;var l=this.props.prefixCls;return e.createElement("table",{ref:"header"+n},e.createElement("colgroup",null,i.map(function(t,n){return e.createElement("col",{key:n,style:Y(t)})})),e.createElement("thead",null,e.createElement("tr",{className:l+"-row "+l+"-row--header"},i.map(function(t,n){return e.createElement("td",{key:t.dataIndex||n,className:l+"-cell "+l+"-cell--header",style:t.headerStyle},U(t.header,r.data,t))}))))},n.prototype.renderBodySideOf=function(t){var n=this,r=t.side,o=t.data,i=X(t,["side","data"])[r.toLowerCase()+"Columns"];if(0===i.length)return null;var l=this.props.prefixCls;return e.createElement("table",{ref:"body"+r},e.createElement("colgroup",null,i.map(function(t,n){return e.createElement("col",{key:n,style:Y(t)})})),e.createElement("tbody",{ref:"body"+r+"Content"},o.map(function(t,r){return e.createElement("tr",{key:r,className:l+"-row "+l+"-row--body",onMouseEnter:function(){return n.handleRowEnter(r)},onMouseLeave:function(){return n.handleRowLeave(r)},onClick:function(){return n.handleClickRow(t,r)}},i.map(function(n,r){return e.createElement("td",{key:r,style:n.cellStyle,className:l+"-cell "+l+"-cell--body "+(n.cellClassName||"")},U(n.cell,t,o,n))}))})))},n.prototype.renderVirtualTable=function(t){var n=t.data,r=t.columns,o=this.props.prefixCls;return e.createElement("table",{className:o+"-hidden-layout",ref:"virtualTable"},e.createElement("colgroup",null,r.map(function(t,n){return e.createElement("col",{key:n,style:Y(t)})})),e.createElement("thead",null,e.createElement("tr",{className:o+"-row "+o+"-row--header"},r.map(function(n,r){return e.createElement("td",{key:n.dataIndex||r,className:o+"-cell "+o+"-cell--header",style:n.headerStyle},U(n.header,t.data,n))}))),e.createElement("tbody",{ref:"virtualTableBody"},n.map(function(t,i){return e.createElement("tr",{key:i,className:o+"-row "+o+"-row--body"},r.map(function(r,i){return e.createElement("td",{key:i,style:r.cellStyle,className:o+"-cell "+o+"-cell--body "+(r.cellClassName||"")},U(r.cell,t,n,r))}))})))},n.prototype.render=function(){var t=this,n=this.props,r=n.data,o=n.columns,i=n.prefixCls,l=n.style,s=n.className,a=o.slice(),c=o.filter(function(e){return"left"===e.fixed}),d=o.filter(function(e){return"right"===e.fixed}),u=function(e){return{side:e,columns:o,leftColumns:c,rightColumns:d,middleColumns:a,data:r}};return e.createElement("div",{className:i+" "+(s||""),key:"rb-table",ref:this.setTableRef,onWheel:this.handleScroll,style:l},e.createElement("div",{ref:"scrollX",className:i+"-scrollx",onScroll:function(){return t.scrollByOffset(0,0)}},e.createElement("div",{className:i+"__header",ref:"header"},this.renderHeaderSideOf(u("Middle"))),e.createElement("div",{className:i+"__body",ref:"body",onScroll:function(){return t.scrollByOffset(0,0)}},this.renderBodySideOf(u("Middle")),this.renderVirtualTable(u("virtual")))),c.length&&e.createElement("div",{className:i+"-fixed "+i+"-fixed--left"},e.createElement("div",{className:i+"-fixed__header"},this.renderHeaderSideOf(u("Left"))),e.createElement("div",{className:i+"-fixed__body"},this.renderBodySideOf(u("Left")))),d.length&&e.createElement("div",{className:i+"-fixed "+i+"-fixed--right"},e.createElement("div",{className:i+"-fixed__header"},this.renderHeaderSideOf(u("Right"))),e.createElement("div",{className:i+"-fixed__body"},this.renderBodySideOf(u("Right")))),e.createElement("div",{className:i+"__vscroll",ref:"vScrollPanel",onMouseDown:this.vScrollPanelMouseDown},e.createElement("div",{ref:"vScrollBar",onMouseDown:this.vScrollBarMouseDown,className:i+"__vscroll__bar"})),e.createElement("div",{className:i+"__hscroll",ref:"hScrollPanel",onMouseDown:this.hScrollPanelMouseDown},e.createElement("div",{ref:"hScrollBar",onMouseDown:this.hScrollBarMouseDown,className:i+"__hscroll__bar"})),this.props.children)},n}(e.Component);return Z.propTypes={columns:E.arrayOf(E.shape({header:E.oneOfType([E.string,E.number,E.func,E.element]).isRequired,cell:E.oneOfType([E.string,E.number,E.func,E.element]).isRequired,width:E.number,minWidth:K,maxWidth:K,fixed:E.oneOf(["left","right"]),className:E.string,onRowClick:E.func})),data:E.array.isRequired,prefixCls:E.string.isRequired},Z.defaultProps={prefixCls:"rb-table",data:[]},Z});
